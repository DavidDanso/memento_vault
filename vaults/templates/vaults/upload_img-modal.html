{% load static %}
<!--=========================================== uploadImageModal--layout ===============================-->
<div id="uploadImageModal">
  <div class="modal fade" id="uploadImg" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="staticBackdropLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content">
        <div class="modal-header">
          <h1>{{vault.title}} - Vault</h1>
          <img src="{% static 'images/close-icon.png' %}" class="img-fluid btn-close" id="close_svg" data-bs-dismiss="modal" aria-label="Close" alt="close_svg" />
        </div>
        <!-- end modal-header -->
        <div class="modal-body">
          <p>Share your best moments with others. Upload your <span></span> favorite videos and images.</p>

          <!--  -->
          <div class="card d-flex mx-auto" id="main_card">
            <div class="card-body">
              <!--  -->
              <div id="upload_div">
                <div class="card" id="uploads_card">
                  <div class="card-body">
                    <img src="{% static 'images/upload.png' %}" class="img-fluid d-flex mx-auto" id="uploads_img" alt="uploads_img" />

                    <!--  -->
                    <form action="" method="POST" enctype="multipart/form-data" id="uploadForm">
                      {% csrf_token %}
                      <div class="input-group mb-3" id="upload_field">
                        <input type="file" name="file" multiple class="input form-control" />
                        <!-- Allow multiple uploads -->
                        <input type="submit" id="media_btn" class="btn" value="Upload Media" data-bs-dismiss="modal" aria-label="Close" />
                      </div>
                      <!-- end upload_field -->
                    </form>
                    <!-- end uploadForm -->
                  </div>
                  <!-- end card-body -->
                </div>
                <!-- end uploads_card -->
              </div>
              <!-- end upload_div -->
              <!--  -->
              <h6>
                Please note:
                <span>You have {{ remaining_uploads }} more upload{{ remaining_uploads|pluralize }} left.</span>
              </h6>
              <!--  -->
            </div>
            <!-- end card-body -->
          </div>
          <!-- end card -->
          <!--  -->
        </div>
        <!-- end modal-body -->
      </div>
    </div>
  </div>
  <!-- end viewImageModal -->
</div>
<!-- end uploadImageModal -->

<script>
  document.addEventListener("DOMContentLoaded", function () {
    const uploadButton = document.getElementById("media_btn");
    const uploadCard = document.getElementById("upload_card");
    const fileInput = document.querySelector('input[type="file"]');

    // Check if we have an upload indicator in the URL
    const urlParams = new URLSearchParams(window.location.search);
    const uploaded = urlParams.get("uploaded");

    // Show card only if coming from a successful upload
    if (uploaded) {
      uploadCard.style.display = "block";
      // Clean the URL after showing the card
      window.history.replaceState({}, document.title, window.location.pathname);
    } else {
      uploadCard.style.display = "none";
    }

    fileInput.addEventListener("change", function () {
      if (this.files.length > 0) {
        uploadButton.value = "Upload Media";
      }
    });

    uploadButton.addEventListener("click", function (event) {
      if (fileInput.files.length > 0) {
        uploadButton.value = "Uploading...";
        uploadCard.style.display = "block";
      } else {
        event.preventDefault();
      }
    });
  });
</script>
